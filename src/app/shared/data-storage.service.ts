import { HttpClient, HttpParams } from "@angular/common/http";
import { Injectable } from "@angular/core"
import { exhaustMap, map, take, tap } from "rxjs";
import { AuthService } from "../auth/auth.service";
import { Recipe } from "../recipes/recipe.model";
import { RecipeService } from "../recipes/recipes.service";

@Injectable({ providedIn: 'root' })
export class DataStorageService {
    constructor(private http: HttpClient,
        private recipeService: RecipeService,
        private authService: AuthService,) { }

    storeRecipes() {
        const recipes = this.recipeService.getRecipes();
        //return this.http.put('https://ng-recipe-book-27dfd-default-rtdb.firebaseio.com/recipes.json', recipes);
        this.http.put('https://ng-recipe-book-27dfd-default-rtdb.firebaseio.com/recipes.json', recipes)
            .subscribe(
                response => {
                    console.log(response);
                }
            );
    }

    fetchRecipes() {

        return this.http.get<Recipe[]>('https://ng-recipe-book-27dfd-default-rtdb.firebaseio.com/recipes.json').pipe(

            map(recipes => {
                return recipes.map(recipe => {
                    return { ...recipe, ingredients: recipe.ingredients ? recipe.ingredients : [], imagePath: recipe.imagePath ? recipe.imagePath : 'data:image/png;base64,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' }
                });
            }), tap(recipes => {
                this.recipeService.setRecipes(recipes);
            }))


    }
}